#!/bin/bash
# Algorithme de compilation du document.

source ._bash_common

needscmd clear

touch rapport.ann # N'est plus défini après `clean`, ce qui ferait planter la compilation

declare -i etape=0

compiler() {
	let etape++
	clear
	echo "== Compilation #$etape =="
	cp rapport.ann annexes.tex
	pdflatex rapport || exit 1
}

# Lecture de la bibliographie
compiler

# Pré-intégration de la bibliographie
declare -i sousEtape=1
while [ -f rapport$sousEtape.aux ]
do
	clear
	echo "== Compilation #$etape.$sousEtape =="
	bibtex rapport$sousEtape || exit 1
	let sousEtape++
done

# Intégration de la bibliographie
# Géneration du sommaire
compiler

# Intégration du sommaire
compiler

rm annexes.tex
